- content_for :head do
  = stylesheet_link_tag "application"
  = javascript_include_tag "application"
  = javascript_include_tag "legacy/common"
  = stylesheet_link_tag "legacy/reset"
  = stylesheet_link_tag "legacy/common"
  = stylesheet_link_tag "legacy/style"
  = stylesheet_link_tag "legacy/trip_detail"
  %script{:src => "/assets/legacy/jquery/js/jquery.tools.min.js", :type => "text/javascript"}

- content_for :page_title do
  Trip Details

- content_for :page_content do
  #page.trip-details

    #trail-details.trail-details-overlay
      != @trip.description

    #details-section
      #plan.alt.trip
        #trip-meta
          / end share widgets
          .header
            %h2 #{@trip.name}
            %img.type-flag{:alt => "", :src => "/assets/legacy/trip.png"}/
            - if @trip.starting_trailhead.default_park
              %em
              %a{:href => "#{park_path(@trip.starting_trailhead.default_park)}"} #{@trip.starting_trailhead.default_park.name}
          / b:details
          #trailhead-details
            - if @trip.description
              .description
                != truncate_html(@trip.description, :length=> 300,  :omission => '...<br/><a class="trail-details-modal modal" rel="#trail-details" >Read more...</a>')
              / e: entry
            - else
              %div{:style => "height:10px"}

            = render :partial => "/shared/partials/features", :locals => {:object=>@trip}

            .button-frame

              %a.green-button.padded-sides{:href => "/embed/plan/trip/#{@trip.id}"}
                Plan Trip to Here

            - if can?(:edit,@trip)
              .button-frame
                %a.green-button{:href => "#{edit_trip_path(@trip)}", :target=>"_blank"} Edit Trip

            - if can?(:destroy,@trip)
              .button-frame
                = link_to("Delete Trip", @trip, :method => :delete, :confirm => "Are you sure?", :class=>"green-button")

            = render :partial => "/shared/partials/object_maps", :locals => {:object=>@trip}

          = render :partial => "/shared/partials/agency", :locals => {:object=>@trip}

          - regional_trails = @trip.trip_features.where(:category_id=>Category.where(:name=>"Regional Trail"))
          - regional_trails.each do |feature|
            - klass = feature == regional_trails.last ? "agency last" : "agency"
            .if.endif{:class => "#{klass}"}
              .logo
                - if feature.marker_icon
                  - if feature.link_url
                    %a{:href => "#{feature.link_url}", :target => "_blank"}
                      %img{:src => "#{feature.marker_icon.url}"}/
                  - else
                    %img{:src => "#{feature.marker_icon.url}"}/
              .text
                This trail is part of the
                .name
                  - if feature.link_url
                    %a{:href => "#{feature.link_url}", :target => "_blank"}
                      #{ feature.name }
                  - else
                    #{feature.name}

          = render :partial => "/shared/partials/non_profit_partner", :locals => {:object=>@trip}
          / = render :partial => "/shared/partials/contributor", :locals => {:object=>@trip}

  :javascript
    $(function(){
      $("a.modal").overlay();
    });
